(e=>{function t(e,t){const n=document.createElement(e);if(t)for(const e in t)"class"===e?n.className=t[e]:n.setAttribute(e,t[e]);return n}let n=0;function i(){return(n++).toString(36)+Math.random().toString(36).slice(2)}function s(e){return e.replace(/([^&]|^)&([^&\s])/,"$1<span class='menu-hotkey'>$2</span>").replace(/&&/g,"&")}const o="MENU_DIVIDER",l=1e3;let a=1;function r(){return"undefined"!=typeof $Window?$Window.Z_INDEX+++l:++a+l}e.MenuBar=function e(n){if(!(this instanceof e))return new e(n);const l=t("div",{class:"menus",role:"menubar","aria-label":"Application Menu"});function a(){return window.get_direction?window.get_direction():getComputedStyle(l).direction}l.style.touchAction="none";let d=!1;const u=[];let c,p=-1;const h=new WeakMap,m=new WeakMap,f=new WeakMap,b=()=>{for(const{menu_button_el:e}of u)"true"===e.getAttribute("aria-expanded")&&e.dispatchEvent(new CustomEvent("release"),{})},v=()=>{const e=l.closest(".window");e&&e.dispatchEvent(new CustomEvent("refocus-window"))},w=e=>{const t="string"==typeof e?Object.keys(n).indexOf(e):e;-1!==p&&p!==t&&u[p].menu_button_el.classList.remove("highlight"),-1!==t&&u[t].menu_button_el.classList.add("highlight"),p=t};function y(e){const t=e?.description||"";if(window.jQuery){const e=new window.jQuery.Event("info",{detail:{description:t}}),n={toString:()=>(console.warn("jQuery extra parameter for info event is deprecated, use event.detail instead"),t)};window.jQuery(l).trigger(e,n)}else l.dispatchEvent(new CustomEvent("info",{detail:{description:t}}))}function g(e){if(e.defaultPrevented)return;const t=c?.element,n=u[p],{menu_button_el:i,open_top_level_menu:s}=n||{},o=t||n?.menu_popup_el,r=f.get(t),d=o?.querySelector(".menu-item.highlight");switch(e.key){case"ArrowLeft":case"ArrowRight":const t="ArrowRight"===e.key;if(d?.matches(".has-submenu:not([aria-disabled='true'])")&&"ltr"===a()===t)d.click(),e.preventDefault();else if(c&&c.parentMenuPopup&&"ltr"===a()!==t)c.close(!0),r.setAttribute("aria-expanded","false"),y(c.menuItems[c.itemElements.indexOf(r)]),e.preventDefault();else if(d||!c||!c.parentMenuPopup){const n=o&&"none"!==o.style.display,s="ltr"===a()===t?1:-1;let l;l=-1===p?1===s?0:u.length-1:(p+s+u.length)%u.length;const r=u[l],d=r.menu_button_el;n?r.open_top_level_menu("keydown"):(i?.dispatchEvent(new CustomEvent("release"),{}),d.focus({preventScroll:!0}),w(l)),e.preventDefault()}break;case"ArrowUp":case"ArrowDown":const n="ArrowDown"===e.key;if(c){const t=n?1:-1,i=[...o.querySelectorAll(".menu-item")],s=i.indexOf(d);let l=(s+t+i.length)%i.length;-1===s&&(l=n?0:i.length-1);const a=i[l];c.highlight(a),y(c.menuItems[c.itemElements.indexOf(a)]),e.preventDefault()}else s?.("keydown");e.preventDefault();break;case"Escape":if(c)r&&r!==i?(c.close(!0),r.setAttribute("aria-expanded","false"),y(c.menuItems[c.itemElements.indexOf(r)])):(b(),i.focus({preventScroll:!0})),e.preventDefault();else{const t=l.closest(".window");t&&(t.dispatchEvent(new CustomEvent("refocus-window")),e.preventDefault())}break;case"Alt":b(),v(),e.preventDefault();break;case"Space":break;case"Enter":i===document.activeElement?(s("keydown"),e.preventDefault()):(d?.click(),e.preventDefault());break;default:if(e.ctrlKey||e.metaKey)break;const h=e.key.toLowerCase(),m=c?[...o.querySelectorAll(".menu-item")]:u.map((e=>e.menu_button_el)),f={};for(const e of m){const t=e.querySelector(".menu-hotkey"),n=(t?t.textContent:(e.querySelector(".menu-item-label")??e).textContent[0]).toLowerCase();f[n]=f[n]||[],f[n].push(e)}const g=f[h]||[];if(g.length)if(1===g.length){const t=g[0],n=u.find((e=>e.menu_button_el===t));n?n.open_top_level_menu("keydown"):t.click(),e.preventDefault()}else{let t=g.indexOf(d);t=-1===t?0:(t+1)%g.length;const n=g[t];c.highlight(n),e.preventDefault()}}}function E(e,{parentMenuPopup:n}={}){this.parentMenuPopup=n,this.menuItems=e,this.itemElements=[];const l=t("div",{class:"menu-popup",id:`menu-popup-${i()}`,tabIndex:"-1",role:"menu"});l.style.touchAction="pan-y",l.style.outline="none";const d=t("table",{class:"menu-popup-table",role:"presentation"});l.appendChild(d),this.element=l,h.set(l,this);let u,p=[];l.addEventListener("keydown",g),l.addEventListener("pointerleave",(()=>{for(const e of p)if("none"!==e.submenu_popup_el.style.display)return void this.highlight(e.item_el);this.highlight(-1)})),l.addEventListener("focusin",(e=>{l.focus({preventScroll:!0})})),this.highlight=e=>{let t=e;"number"==typeof e&&(t=this.itemElements[e]),u&&u!==t&&u.classList.remove("highlight"),t?(t.classList.add("highlight"),l.setAttribute("aria-activedescendant",t.id),u=t):(l.removeAttribute("aria-activedescendant"),u=null)},this.close=(e=!0)=>{for(const e of p)e.submenu_popup.close(!1);e&&this.parentMenuPopup?.element.focus({preventScroll:!0}),l.style.display="none",this.highlight(-1),c===this&&(c=this.parentMenuPopup)};const w=(e,n,d)=>{const u=t("tr",{class:"menu-row"});if(this.itemElements.push(u),e.appendChild(u),n===o){const w=t("td",{colspan:4}),g=t("hr",{class:"menu-hr"});w.appendChild(g),u.appendChild(w),g.addEventListener("pointerenter",(()=>{this.highlight(-1)}))}else{const k=u;k.classList.add("menu-item"),k.id=`menu-item-${i()}`,k.tabIndex=-1,k.setAttribute("role",n.checkbox?"radio"===n.checkbox.type?"menuitemradio":"menuitemcheckbox":"menuitem"),k.setAttribute("aria-label",(n.label||n.item).replace(/\s?\(&.\)/,"").replace(/([^&]|^)&([^&\s])/,"$1$2")),k.setAttribute("aria-keyshortcuts",n.ariaKeyShortcuts||n.shortcut||n.shortcutLabel),n.description&&k.setAttribute("aria-description",n.description);const _=t("td",{class:"menu-item-checkbox-area"}),L=t("td",{class:"menu-item-label"}),x=t("td",{class:"menu-item-shortcut"}),A=t("td",{class:"menu-item-submenu-area"});let C,M;if(k.appendChild(_),k.appendChild(L),k.appendChild(x),k.appendChild(A),L.innerHTML=s(n.label||n.item),x.textContent=n.shortcut,l.addEventListener("update",(()=>{if((e=>"function"==typeof e.enabled?!e.enabled():"boolean"==typeof e.enabled&&!e.enabled)(n)?(k.setAttribute("disabled",""),k.setAttribute("aria-disabled","true")):(k.removeAttribute("disabled"),k.removeAttribute("aria-disabled")),n.checkbox&&n.checkbox.check){const e=n.checkbox.check();k.setAttribute("aria-checked",e?"true":"false")}})),k.addEventListener("pointerenter",(()=>{this.highlight(d),y(n)})),k.addEventListener("pointerleave",(e=>{"none"!==l.style.display&&"touch"!==e.pointerType&&y()})),"radio"===n.checkbox?.type?_.classList.add("radio"):n.checkbox&&_.classList.add("checkbox"),n.submenu){k.classList.add("has-submenu"),A.classList.toggle("point-right","rtl"===a());const $=new E(n.submenu,{parentMenuPopup:this});function h(){for(const{submenu_popup:e,item_el:t}of p)e.close(!1),t.setAttribute("aria-expanded","false");l.focus({preventScroll:!0})}let I,S;M=$.element,document.body?.appendChild(M),M.style.display="none",k.setAttribute("aria-haspopup","true"),k.setAttribute("aria-expanded","false"),k.setAttribute("aria-controls",M.id),m.set(k,$),f.set(M,k),M.dataset.semanticParent=l.id,l.setAttribute("aria-owns",`${l.getAttribute("aria-owns")||""} ${M.id}`),M.setAttribute("aria-labelledby",k.id),C=(e=!0)=>{if("none"!==M.style.display)return;if("true"===k.getAttribute("aria-disabled"))return;h(),k.setAttribute("aria-expanded","true"),M.style.display="",M.style.zIndex=r(),M.setAttribute("dir",a()),window.inheritTheme&&window.inheritTheme(M,l),M.parentElement||document.body.appendChild(M),M.dispatchEvent(new CustomEvent("update"),{}),e?($.highlight(0),y($.menuItems[0])):$.highlight(-1);const t=k.getBoundingClientRect();let n=M.getBoundingClientRect();M.style.position="absolute",M.style.left=`${("rtl"===a()?t.left-n.width:t.right)+window.scrollX}px`,M.style.top=`${t.top+window.scrollY}px`,n=M.getBoundingClientRect(),"rtl"===a()?n.left<0&&(M.style.left=`${t.right}px`,n=M.getBoundingClientRect(),n.right>innerWidth&&(M.style.left=innerWidth-n.width+"px")):n.right>innerWidth&&(M.style.left=t.left-n.width+"px",n=M.getBoundingClientRect(),n.left<0&&(M.style.left="0")),M.focus({preventScroll:!0}),c=$},p.push({item_el:k,submenu_popup_el:M,submenu_popup:$}),M.addEventListener("pointerenter",(()=>{I&&(clearTimeout(I),I=null),S&&(clearTimeout(S),S=null)})),k.addEventListener("pointerenter",(()=>{I&&(clearTimeout(I),I=null),S&&(clearTimeout(S),S=null),I=setTimeout((()=>{C(!1)}),501)})),k.addEventListener("pointerleave",(()=>{I&&(clearTimeout(I),I=null)})),l.addEventListener("pointerenter",(e=>{e.target.closest(".menu-item")!==k&&(S||"none"!==M.style.display&&(S=setTimeout((()=>{window.debugKeepMenusOpen||h()}),500)))})),l.addEventListener("pointerleave",(()=>{S&&(clearTimeout(S),S=null)})),k.addEventListener("pointerdown",(()=>{C(!1)}))}let D=!1;const T=()=>{D||(D=!0,setTimeout((()=>{D=!1}),10),n.checkbox?(n.checkbox.toggle&&n.checkbox.toggle(),l.dispatchEvent(new CustomEvent("update"),{})):n.action&&(b(),v(),n.action()))};k.addEventListener("pointerup",(e=>{"mouse"===e.pointerType&&0!==e.button||"touch"!==e.pointerType&&k.click()})),k.addEventListener("click",(e=>{n.submenu?C(!0):T()}))}};0===e.length&&(e=[{label:"(Empty)",enabled:!1}]);let k=0;for(const n of e)if(n.radioItems){const e=t("tbody",{role:"group"});n.ariaLabel&&e.setAttribute("aria-label",n.ariaLabel);for(const t of n.radioItems)t.checkbox={type:"radio",check:()=>t.value===n.getValue(),toggle:()=>{n.setValue(t.value)}},w(e,t,k++);d.appendChild(e)}else w(d,n,k++)}l.addEventListener("pointerleave",(()=>{-1!==p&&"none"===u[p].menu_popup_el.style.display&&w(-1)})),l.addEventListener("keydown",g);const k=(e,o)=>{const h=t("div",{class:"menu-button","aria-expanded":"false","aria-haspopup":"true",role:"menuitem"});l.appendChild(h);const g=new E(o),k=g.element;document.body?.appendChild(k),m.set(h,g),f.set(k,h),h.id=`menu-button-${e}-${i()}`,k.dataset.semanticParent=h.id,h.setAttribute("aria-controls",k.id),k.setAttribute("aria-labelledby",h.id),l.setAttribute("aria-owns",`${l.getAttribute("aria-owns")||""} ${k.id}`);const _=()=>{const e=h.getBoundingClientRect();let t=k.getBoundingClientRect();k.style.position="absolute",k.style.left=`${("rtl"===a()?e.right-t.width:e.left)+window.scrollX}px`,k.style.top=`${e.bottom+window.scrollY}px`;const n=k.getBoundingClientRect();Math.floor(n.right)>innerWidth&&(k.style.left=innerWidth-n.width+"px"),Math.ceil(n.left)<0&&(k.style.left="0px")};window.addEventListener("resize",_),k.addEventListener("update",_);const L=e.replace("&","").replace(/ /g,"-").toLowerCase();function x(t="other"){Object.keys(n).indexOf(e)===p&&"true"===h.getAttribute("aria-expanded")||(b(),h.classList.add("active"),h.setAttribute("aria-expanded","true"),k.style.display="",k.style.zIndex=r(),k.setAttribute("dir",a()),window.inheritTheme&&window.inheritTheme(k,l),k.parentElement||document.body.appendChild(k),w(e),k.dispatchEvent(new CustomEvent("update"),{}),d=!0,k.focus({preventScroll:!0}),c=g,"keydown"===t?(g.highlight(0),y(g.menuItems[0])):y())}var A;h.classList.add(`${L}-menu-button`),k.style.display="none",h.innerHTML=s(e),h.tabIndex=-1,h.setAttribute("aria-haspopup","true"),h.setAttribute("aria-controls",k.id),h.addEventListener("focus",(()=>{w(e)})),h.addEventListener("pointerdown",(e=>{h.classList.contains("active")?(h.dispatchEvent(new CustomEvent("release",{})),v(),e.preventDefault()):x(e.type)})),h.addEventListener("pointermove",(t=>{w(e),"touch"!==t.pointerType&&d&&x(t.type)})),h.addEventListener("release",(()=>{d=!1,h.classList.remove("active"),window.debugKeepMenusOpen||(g.close(!0),h.setAttribute("aria-expanded","false")),l.dispatchEvent(new CustomEvent("default-info",{}))})),u.push({menu_button_el:h,menu_popup_el:k,menus_key:e,hotkey:(A=e,A[function(e){return` ${e}`.search(/[^&]&[^&\s]/)}(A)+1].toUpperCase()),open_top_level_menu:x})};for(const e in n)k(e,n[e]);function _(e){e.target?.closest?.(".menus")===l||e.target?.closest?.(".menu-popup")||(b(),w(-1))}window.addEventListener("keydown",(e=>{document.activeElement&&document.activeElement.closest&&document.activeElement.closest(".menus, .menu-popup")||"Escape"===e.key&&c&&(b(),e.preventDefault())})),window.addEventListener("blur",(e=>{e.isTrusted&&b()})),window.addEventListener("pointerdown",_),window.addEventListener("pointerup",_),window.addEventListener("focusout",(e=>{e.relatedTarget?.closest?.(".menus")===l||e.relatedTarget?.closest?.(".menu-popup")||(b(),w(u.findIndex((({menu_button_el:e})=>e.matches(":hover")))))}));let L=[];function x(...e){for(const e of L)e.removeEventListener("keydown",A);L=e;for(const e of L)e.addEventListener("keydown",A)}function A(e){if(!e.ctrlKey&&!e.metaKey||"Control"===e.key||"Meta"===e.key){if(!e.defaultPrevented&&e.altKey&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){const t=u.find((t=>t.hotkey.toLowerCase()===e.key.toLowerCase()));t&&(e.preventDefault(),t.open_top_level_menu("keydown"))}}else b()}x(window),this.element=l,this.closeMenus=b,this.setKeyboardScope=x},e.MENU_DIVIDER=o})(window);