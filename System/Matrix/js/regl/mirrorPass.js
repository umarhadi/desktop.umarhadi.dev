import{loadText,makePass,makePassFBO}from"./utils.js";let start;const numClicks=5,clicks=Array(5).fill([0,0,-1/0]).flat();let aspectRatio=1,index=0;window.onclick=e=>{clicks[3*index+0]=0+e.clientX/e.srcElement.clientWidth,clicks[3*index+1]=1-e.clientY/e.srcElement.clientHeight,clicks[3*index+2]=(Date.now()-start)/1e3,index=(index+1)%5};export default({regl:e,config:a,cameraTex:t,cameraAspectRatio:s},i)=>{const c=makePassFBO(e,a.useHalfFloat),l=loadText("shaders/glsl/mirrorPass.frag.glsl"),r=e({frag:e.prop("frag"),uniforms:{time:e.context("time"),tex:i.primary,bloomTex:i.bloom,cameraTex:t,clicks:()=>clicks,aspectRatio:()=>aspectRatio,cameraAspectRatio:s},framebuffer:c});return start=Date.now(),makePass({primary:c},Promise.all([l.loaded]),((e,a)=>{c.resize(e,a),aspectRatio=e/a}),(()=>r({frag:l.text()})))};